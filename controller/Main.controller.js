sap.ui.define(["sap/ui/core/mvc/Controller"],t=>{"use strict";return t.extend("bq.benqyou.controller.Main",{onInit(){},onFileUpload:function(t){const e=this.getView().getModel("loaderModel");const o=t.getParameter("files");const n=o&&o[0];if(!n)return;const s=n.name.toLowerCase();if(s.endsWith(".txt")){const t=new FileReader;t.onload=function(t){const o=t.target.result;const n=o.split(/\r?\n/);const s=[];let i=0;n.forEach(t=>{if(!t.trim())return;const e=t.split("=");const o=e[0];const n=e[1]!==undefined?e[1]:null;s.push({id:i,key:o,value:n});i++});e.setData(s);e.setProperty("/isEditable",false);this.onOpenDialog()}.bind(this);t.readAsText(n);return}if(s.endsWith(".pdf")){const t=new FileReader;t.onload=async function(t){const o=new Uint8Array(t.target.result);const n=window.pdfjsLib;if(!n){console.error("Error with PDF.js library.");return}try{const t=await n.getDocument({data:o}).promise;const s=[];let i=0;for(let e=1;e<=t.numPages;e++){const o=await t.getPage(e);const n=await o.getTextContent();const r=new Map;n.items.forEach(t=>{const e=Math.round(t.transform[5]);if(!r.has(e)){r.set(e,[])}r.get(e).push(t.str)});const a=Array.from(r.keys()).sort((t,e)=>e-t);a.forEach(t=>{const e=r.get(t).join(" ");const o=e.split("=");const n=o[0];const a=o[1]!==undefined?o[1]:null;s.push({id:i,key:n,value:a});i++})}e.setData(s);e.setProperty("/isEditable",false);this.onOpenDialog()}catch(t){console.error("Error while loading PDF file: ",t)}}.bind(this);t.readAsArrayBuffer(n);return}},onOpenDialog:async function(){this.oDialog??=await this.loadFragment({name:"bq.benqyou.view.Loader"});this.oDialog.open()},closeDialog:function(){this.oDialog.close();this.byId("fileUploader").clear()},saveData:function(){this.closeDialog();this.byId("startPanel").setVisible(false);this.byId("quizView").setVisible(true);const t=this.getView().getModel("loaderModel");const e=t.getData();t.setProperty("/isQuestionVisible",false);e.sort(()=>Math.random()-.5)},onPressDelete:function(t){const e=t.getSource().getBindingContext("loaderModel").getProperty("id");const o=this.getView().getModel("loaderModel");const n=o.getData();const s=n.findIndex(t=>t.id===e);if(s!==-1){n.splice(s,1);o.refresh(true)}},toggleEdit:function(){const t=this.getView().getModel("loaderModel");const e=t.getProperty("/isEditable");t.setProperty("/isEditable",!e)}})});
//# sourceMappingURL=Main.controller.js.map